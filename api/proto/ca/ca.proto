syntax = "proto3";

package gigvault.ca.v1;

option go_package = "github.com/gigvault/shared/api/proto/ca";

import "google/protobuf/timestamp.proto";

// CAService handles certificate authority operations
service CAService {
  // SignCSR signs a certificate signing request
  rpc SignCSR(SignCSRRequest) returns (SignCSRResponse);
  
  // GetCertificate retrieves a certificate by serial number
  rpc GetCertificate(GetCertificateRequest) returns (GetCertificateResponse);
  
  // ListCertificates lists certificates with optional filtering
  rpc ListCertificates(ListCertificatesRequest) returns (ListCertificatesResponse);
  
  // RevokeCertificate revokes a certificate
  rpc RevokeCertificate(RevokeCertificateRequest) returns (RevokeCertificateResponse);
}

message SignCSRRequest {
  string csr_pem = 1;
  int32 validity_days = 2;
  string profile = 3; // server, client, code-signing, etc.
  map<string, string> extensions = 4; // Additional extensions
}

message SignCSRResponse {
  string certificate_pem = 1;
  string serial_number = 2;
  google.protobuf.Timestamp not_before = 3;
  google.protobuf.Timestamp not_after = 4;
}

message GetCertificateRequest {
  string serial_number = 1;
}

message GetCertificateResponse {
  string certificate_pem = 1;
  string serial_number = 2;
  string subject_cn = 3;
  string issuer_cn = 4;
  google.protobuf.Timestamp not_before = 5;
  google.protobuf.Timestamp not_after = 6;
  string status = 7; // valid, revoked, expired
  google.protobuf.Timestamp revoked_at = 8;
  string revocation_reason = 9;
}

message ListCertificatesRequest {
  string status = 1; // Filter by status (optional)
  int32 page_size = 2;
  string page_token = 3;
}

message ListCertificatesResponse {
  repeated CertificateInfo certificates = 1;
  string next_page_token = 2;
}

message CertificateInfo {
  string serial_number = 1;
  string subject_cn = 2;
  google.protobuf.Timestamp not_before = 3;
  google.protobuf.Timestamp not_after = 4;
  string status = 5;
}

message RevokeCertificateRequest {
  string serial_number = 1;
  string reason = 2; // unspecified, keyCompromise, cACompromise, etc.
}

message RevokeCertificateResponse {
  bool success = 1;
  string message = 2;
  google.protobuf.Timestamp revoked_at = 3;
}

